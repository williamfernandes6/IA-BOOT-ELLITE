<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA ELITE PRO - PROTOCOLO LUANDA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap');
        
        :root {
            --neon-pink: #db2777;
            --neon-green: #22c55e;
            --bg-dark: #050507;
        }

        body { 
            background-color: var(--bg-dark); 
            color: #ffffff; 
            font-family: 'Inter', sans-serif; 
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        .glass-panel { 
            background: rgba(18, 18, 22, 0.98); 
            border: 1px solid rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(20px);
            border-radius: 24px;
        }

        .neon-container { 
            border: 1px solid rgba(219, 39, 119, 0.3); 
            box-shadow: 0 0 40px rgba(219, 39, 119, 0.1); 
            background: linear-gradient(180deg, rgba(18,18,22,1) 0%, rgba(10,10,12,1) 100%);
        }

        .status-badge {
            font-size: 10px;
            font-weight: 900;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 6px 12px;
            border-radius: 8px;
            background: rgba(255,255,255,0.03);
        }

        .btn-action {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-action:active { transform: scale(0.96); }

        .chip-vela {
            font-size: 11px;
            padding: 5px 10px;
            border-radius: 6px;
            font-weight: 800;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            min-width: 55px;
            text-align: center;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.2); }
        }

        .animate-led { animation: pulse-dot 2s infinite ease-in-out; }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050507; }
        ::-webkit-scrollbar-thumb { background: #1f1f23; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 lg:p-10">

    <div class="fixed top-6 right-6 z-50 flex items-center gap-3 glass-panel px-4 py-2 border border-white/5">
        <span class="text-[9px] font-black text-zinc-500 tracking-tighter uppercase">Sistema Central Render</span>
        <div id="render-led" class="w-2.5 h-2.5 rounded-full bg-red-600 animate-led shadow-[0_0_10px_rgba(220,38,38,0.5)]"></div>
    </div>

    <div class="w-full max-w-6xl flex flex-col gap-6">
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="glass-panel p-6 flex justify-between items-center shadow-2xl">
                <div class="flex flex-col">
                    <span class="text-[10px] text-pink-500 font-black uppercase tracking-widest mb-1">Horário Luanda (GMT+1)</span>
                    <div id="clock" class="text-3xl font-orbitron font-bold text-white tracking-widest">00:00:00</div>
                </div>
                <div class="w-12 h-12 rounded-full border border-pink-500/20 flex items-center justify-center">
                    <div class="w-2 h-2 rounded-full bg-pink-500 animate-ping"></div>
                </div>
            </div>

            <div class="glass-panel p-6 flex justify-between items-center shadow-2xl">
                <div class="flex flex-col text-right w-full">
                    <span class="text-[10px] text-zinc-500 font-black uppercase tracking-widest mb-1">Banca Detetada em Tempo Real</span>
                    <div id="banca" class="text-3xl font-bold text-green-500 font-orbitron">Kz ---</div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-7 flex flex-col gap-6">
                
                <div class="glass-panel p-4 flex items-center justify-between border-l-8 transition-all duration-500" id="tendencia-box" style="border-left-color: #27272a;">
                    <div class="flex flex-col">
                        <span class="text-[10px] font-black text-zinc-500 uppercase tracking-widest">Estado Atual do Provedor</span>
                        <span id="tendencia-txt" class="text-xl font-black italic tracking-tight">AGUARDANDO PRINT...</span>
                    </div>
                    <div id="tendencia-led" class="w-4 h-4 rounded-full bg-zinc-700"></div>
                </div>

                <div class="neon-container p-10 rounded-[48px] text-center flex flex-col items-center justify-center min-h-[450px]">
                    <div id="status" class="status-badge text-zinc-500 mb-6">Protocolo de Elite Iniciado</div>
                    
                    <div class="relative mb-8">
                        <div id="timer" class="text-[80px] lg:text-[100px] font-orbitron font-black text-white leading-none tracking-tighter">--:--</div>
                        <div class="absolute -bottom-4 left-0 right-0 text-[10px] font-black text-zinc-600 uppercase tracking-[0.3em]">Previsão Próxima Vela</div>
                    </div>

                    <div class="w-full grid grid-cols-2 gap-6 py-8 border-y border-white/5 my-8">
                        <div class="text-left">
                            <span class="text-[10px] font-black text-zinc-500 uppercase block mb-2">Assertividade IA</span>
                            <div id="pct" class="text-4xl font-black text-pink-500">0%</div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] font-black text-zinc-500 uppercase block mb-2">Alvo Sugerido</span>
                            <div id="alvo" class="text-3xl font-black italic text-white">---</div>
                        </div>
                    </div>

                    <input type="file" id="file" class="hidden" accept="image/*">
                    <div class="w-full flex flex-col gap-4">
                        <button onclick="document.getElementById('file').click()" class="btn-action w-full bg-zinc-800/50 hover:bg-zinc-800 py-4 rounded-2xl text-[11px] font-black text-zinc-300 border border-white/5">
                            Passo 1: Carregar Print do Aviator
                        </button>
                        <button onclick="analisar()" class="btn-action w-full bg-pink-600 hover:bg-pink-700 py-6 rounded-3xl text-xl font-black text-white shadow-[0_10px_30px_rgba(219,39,119,0.3)]">
                            Passo 2: Gerar Sinal Inteligente
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-5 flex flex-col gap-6">
                
                <div class="glass-panel p-8 text-center flex flex-col gap-6">
                    <div class="flex flex-col gap-1">
                        <span class="text-[11px] font-black text-white uppercase tracking-widest">Treinar Super Inteligência</span>
                        <span class="text-[9px] text-zinc-500 uppercase">Confirmar se o sinal anterior foi certeiro em Luanda</span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="feedback('CERTO')" class="btn-action py-4 rounded-2xl border-2 border-green-600/30 text-green-500 font-black text-sm hover:bg-green-600 hover:text-white">
                            SINAL CERTO ✅
                        </button>
                        <button onclick="feedback('ERRADO')" class="btn-action py-4 rounded-2xl border-2 border-red-600/30 text-red-500 font-black text-sm hover:bg-red-600 hover:text-white">
                            SINAL ERRADO ❌
                        </button>
                    </div>
                </div>

                <div class="glass-panel p-6 flex-grow flex flex-col min-h-[300px]">
                    <div class="flex items-center justify-between mb-6">
                        <span class="text-[10px] font-black text-zinc-400 uppercase tracking-widest">Histórico de Fluxo</span>
                        <span class="text-[9px] font-bold text-pink-500 px-2 py-1 bg-pink-500/10 rounded">25 Velas Analisadas</span>
                    </div>
                    <div id="hist" class="flex flex-wrap gap-2.5 justify-center overflow-y-auto">
                        </div>
                </div>

                <div class="p-4 text-center">
                    <p class="text-[9px] font-black text-zinc-700 uppercase tracking-[0.4em]">Protocolo Luanda v6.1 | Super Intelligence Engine</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://ia-boot-elite-backend-qs3x.onrender.com';

        // Sincronização de Relógio Luanda
        setInterval(() => {
            const options = { timeZone: 'Africa/Luanda', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            document.getElementById('clock').innerText = new Intl.DateTimeFormat('pt-PT', options).format(new Date());
        }, 1000);

        // Monitorização do Servidor Render
        async function checkServer() {
            const led = document.getElementById('render-led');
            try {
                const response = await fetch(`${API_URL}/ping`);
                if(response.ok) {
                    led.classList.remove('bg-red-600');
                    led.classList.add('bg-green-500');
                    led.style.boxShadow = '0 0 15px rgba(34,197,94,0.6)';
                }
            } catch(e) {
                led.classList.add('bg-red-600');
                led.style.boxShadow = '0 0 15px rgba(220,38,38,0.6)';
            }
        }
        setInterval(checkServer, 5000);

        // Função de Análise Principal
        async function analisar() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert("ERRO: Carregue um print do Aviator primeiro!");
                return;
            }

            const statusEl = document.getElementById('status');
            statusEl.innerText = "PROCESSANDO ALGORITMO...";
            statusEl.style.color = "#ffffff";

            const formData = new FormData();
            formData.append('print', file);

            try {
                const response = await fetch(`${API_URL}/analisar-fluxo`, {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();

                // Atualizar Interface com Super Inteligência
                document.getElementById('tendencia-txt').innerText = data.tendencia;
                document.getElementById('tendencia-txt').style.color = data.corTendencia;
                document.getElementById('tendencia-led').style.backgroundColor = data.corTendencia;
                document.getElementById('tendencia-box').style.borderLeftColor = data.corTendencia;

                document.getElementById('timer').innerText = data.timerRosa.substring(0, 5);
                document.getElementById('pct').innerText = data.pct;
                document.getElementById('banca').innerText = data.banca;
                document.getElementById('alvo').innerText = data.alvo;
                
                statusEl.innerText = data.status;
                statusEl.style.color = data.cor;

                // Renderizar Histórico de Velas
                const histDiv = document.getElementById('hist');
                histDiv.innerHTML = '';
                data.historico.forEach(vela => {
                    const chip = document.createElement('div');
                    let colorClass = 'bg-blue-600'; // < 2x
                    if (vela >= 10) colorClass = 'bg-pink-600';
                    else if (vela >= 2) colorClass = 'bg-purple-600';
                    
                    chip.className = `chip-vela ${colorClass} text-white`;
                    chip.innerText = vela.toFixed(2) + 'x';
                    histDiv.appendChild(chip);
                });

            } catch (error) {
                console.error(error);
                alert("O servidor Render está a acordar. Aguarde 30 segundos e tente novamente.");
            }
        }

        async function feedback(tipo) {
            try {
                await fetch(`${API_URL}/feedback`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        status: tipo,
                        hora: document.getElementById('clock').innerText,
                        dia: new Date().toLocaleDateString('pt-PT')
                    })
                });
                alert("IA APRENDENDO: Feedback de Luanda guardado com sucesso!");
            } catch(e) {
                alert("Erro ao enviar feedback.");
            }
        }
    </script>
</body>
</html>

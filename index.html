<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA ELITE PRO V2.0 - COMMAND CENTER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;700;900&display=swap');
        :root { --neon: #db2777; --bg: #050507; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 20px; overflow-x: hidden; }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(18, 18, 22, 0.95); border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border-radius: 20px; }
        .neon-border { border: 1px solid rgba(219, 39, 119, 0.3); box-shadow: 0 0 30px rgba(219, 39, 119, 0.05); }
        .scanner { position: absolute; width: 100%; height: 2px; background: var(--neon); box-shadow: 0 0 20px var(--neon); top: 0; display: none; animation: scan 2.5s linear infinite; z-index: 100; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        .log-box { font-family: 'Courier New', monospace; font-size: 10px; color: #10b981; height: 80px; overflow-y: auto; scrollbar-width: none; }
        .log-box::-webkit-scrollbar { display: none; }
        .btn-elite { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-elite:active { transform: scale(0.96); filter: brightness(1.2); }
    </style>
</head>
<body class="space-y-4">

    <div class="fixed top-4 right-4 z-50 flex items-center gap-3 glass px-4 py-2 border border-white/10 rounded-full">
        <div class="flex flex-col items-end">
            <span class="text-[8px] font-black text-zinc-500 uppercase">Latency</span>
            <span id="ms" class="text-[10px] font-bold text-green-500">0ms</span>
        </div>
        <div id="led" class="w-3 h-3 rounded-full bg-red-600 shadow-[0_0_8px_red]"></div>
    </div>

    <div class="glass p-5 flex justify-between items-center w-full max-w-[440px] mt-10 neon-border">
        <div>
            <p class="text-[9px] text-pink-500 font-black uppercase mb-1">Luanda Sector</p>
            <p id="clock" class="text-xl font-orbitron font-bold">00:00:00</p>
        </div>
        <div class="text-right">
            <p class="text-[9px] text-zinc-500 font-black uppercase mb-1">Patrimônio Gerido</p>
            <p id="banca" class="text-xl font-bold text-green-500 font-orbitron">Kz 1.007,00</p>
        </div>
    </div>

    <div class="relative glass p-8 w-full max-w-[440px] text-center neon-border overflow-hidden">
        <div id="scanner" class="scanner"></div>
        <div id="status" class="text-[10px] font-black tracking-[0.3em] text-zinc-500 uppercase mb-8">System Standby</div>
        
        <div class="mb-8">
            <div class="relative inline-block">
                <p id="timer" class="text-7xl font-orbitron font-black text-white tracking-tighter">--:--</p>
                <div id="pulse" class="absolute -top-2 -right-4 w-3 h-3 bg-pink-500 rounded-full animate-ping hidden"></div>
            </div>
            <p class="text-[10px] font-black text-zinc-600 uppercase mt-2 tracking-widest">Entry Point Target</p>
        </div>

        <div class="grid grid-cols-2 gap-4 py-6 border-y border-white/5 mb-6">
            <div class="text-left">
                <span class="text-[9px] font-black text-zinc-500 uppercase block mb-1">Assertividade</span>
                <p id="pct" class="text-4xl font-black text-pink-500">0%</p>
            </div>
            <div class="text-right">
                <span class="text-[9px] font-black text-zinc-500 uppercase block mb-1">Manual Alvo</span>
                <p id="alvo" class="text-2xl font-black italic text-white uppercase">---</p>
            </div>
        </div>

        <div class="bg-black/40 rounded-xl p-3 mb-6 border border-white/5 text-left">
            <p class="text-[8px] font-black text-zinc-600 uppercase mb-2">Audit Log / Manual V2.0</p>
            <div id="log" class="log-box">
                > Sistema aguardando input de dados...<br>
                > Manual V2.0 carregado com sucesso.<br>
                > Gap de 30 velas definido como trigger.
            </div>
        </div>

        <input type="file" id="file" class="hidden" accept="image/*">
        <div class="space-y-3">
            <button onclick="falar('A carregar print para auditoria visual'); document.getElementById('file').click()" class="btn-elite w-full bg-zinc-900/50 py-4 rounded-2xl text-[10px] font-black text-zinc-400 border border-white/10 uppercase tracking-widest hover:bg-zinc-800">1. Analisar Print Real</button>
            <button onclick="analisar()" class="btn-elite w-full bg-pink-600 py-5 rounded-2xl text-xl font-black text-white shadow-[0_10px_40px_rgba(219,39,119,0.3)] uppercase">2. Executar Protocolo</button>
        </div>
    </div>

    <div class="glass p-6 w-full max-w-[440px] text-center neon-border">
        <div class="flex justify-between items-center mb-5">
            <span class="text-[10px] font-black uppercase text-zinc-500 tracking-widest">Fluxo de Tendência</span>
            <span id="tendencia_tag" class="text-[9px] font-bold text-pink-500 uppercase px-2 py-1 bg-pink-500/10 rounded">Análise</span>
        </div>
        <div class="flex flex-wrap gap-2 justify-center" id="hist"></div>
    </div>

    <script>
        // LIGAÇÃO AO TEU BACKEND NO RENDER
        const API_URL = 'https://ia-boot-elite-backend-qs3x.onrender.com';

        function addLog(msg) {
            const log = document.getElementById('log');
            log.innerHTML += `> ${msg}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        function falar(t) {
            window.speechSynthesis.cancel();
            const m = new SpeechSynthesisUtterance(t);
            m.lang = 'pt-PT';
            m.rate = 1.0;
            window.speechSynthesis.speak(m);
        }

        setInterval(() => {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('pt-PT', {timeZone:'Africa/Luanda'});
        }, 1000);

        async function checkServer() {
            const start = Date.now();
            try { 
                const r = await fetch(`${API_URL}/ping`); 
                if(r.ok) {
                    const lat = Date.now() - start;
                    document.getElementById('ms').innerText = `${lat}ms`;
                    document.getElementById('led').className = 'w-3 h-3 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]';
                }
            } catch(e) {
                document.getElementById('led').className = 'w-3 h-3 rounded-full bg-red-600 shadow-[0_0_10px_red]';
            }
        }
        setInterval(checkServer, 4000);

        async function analisar() {
            const f = document.getElementById('file').files[0];
            if(!f) return alert("Erro: Selecione o print da Elephant Bet primeiro!");

            falar("A iniciar auditoria de gráfico. Verificando zona de recolha e gap de 30 velas.");
            document.getElementById('scanner').style.display = 'block';
            document.getElementById('pulse').classList.remove('hidden');
            addLog("Iniciando auditoria visual OCR...");

            const fd = new FormData();
            fd.append('print', f);

            try {
                const res = await fetch(`${API_URL}/analisar-fluxo`, { method: 'POST', body: fd });
                const d = await res.json();

                document.getElementById('scanner').style.display = 'none';
                document.getElementById('pulse').classList.add('hidden');
                
                // Atualizar Interface
                document.getElementById('timer').innerText = d.timer || "IMEDIATO";
                document.getElementById('pct').innerText = d.pct;
                document.getElementById('alvo').innerText = d.alvo;
                document.getElementById('banca').innerText = d.banca;
                document.getElementById('status').innerText = d.status;
                document.getElementById('status').style.color = d.cor;
                document.getElementById('tendencia_tag').innerText = d.tendencia;

                // Logs do Manual
                addLog(`Banca detectada: ${d.banca}`);
                addLog(`Manual V2.0: ${d.status}`);
                addLog(`Decisão: ${d.dica}`);

                falar(`${d.status}. ${d.dica}. Alvo recomendado em ${d.alvo}`);

                // Histórico Visual
                const h = document.getElementById('hist'); h.innerHTML = '';
                d.historico.forEach(v => {
                    const c = document.createElement('div');
                    let bg = v >= 10 ? 'bg-pink-600' : (v >= 2 ? 'bg-purple-600' : 'bg-blue-600');
                    c.className = `px-3 py-1.5 rounded-lg text-[10px] font-black ${bg} text-white min-w-[55px] border border-white/10`;
                    c.innerText = v.toFixed(2) + 'x'; h.appendChild(c);
                });

            } catch(e) { 
                addLog("ERRO: O servidor Render está demorando a responder.");
                falar("Falha na auditoria. Aguarde o servidor acordar.");
                document.getElementById('scanner').style.display = 'none';
            }
        }
    </script>
</body>
</html>
